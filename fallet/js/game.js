function Game(i){this.args=i}Game.prototype={constructor:Game,defaults:{el:"#gamearea",lang:"english",gridPx:50,gridWidth:8,gridHeight:12,initialTick:400,minWordLength:3},arg:function(i){return this.arg[i]||this.defaults[i]},initialize:function(){this.state={},this.score=0,this.grid=new Grid(this.arg("el"),this.arg("gridWidth"),this.arg("gridHeight"),this.arg("gridPx")),this.loadLang(this.arg("lang")),this.tickDelay=this.arg("initialTick"),this.increaseScore(0)},run:function(){var i=this;0!=this.wordstore.isReady?(this.tickInterval=setInterval(function(){i.tick()},this.tickDelay),$(document).on("keydown",function(t){i.grid.hasMovingSquare()&&(39==t.keyCode&&(console.log("MOVE RIGHT"),i.grid.moveSquareRight()),37==t.keyCode&&i.grid.moveSquareLeft())}),$(document).on("touchstart",function(t){if(i.grid.hasMovingSquare()){var r=t.touches[0],e=$(document).width()/2;r.pageX>e?i.grid.moveSquareRight():i.grid.moveSquareLeft()}})):setTimeout(function(){i.run()},100)},tick:function(){this.grid.hasMovingSquare()?this.grid.canMove()?this.grid.moveSquareDown():(this.grid.saveMovingSquare(),this.checkWords()):(this.grid.addSquare(this.wordstore.getLetter()),this.grid.canMove()||this.gameOver())},checkWords:function(){var i=this;clearInterval(this.tickInterval);for(var t=1;this.grid.hasDirtySquares();){for(var r=this.grid.getDirtyRows(),e=0;e<r.length;e++){o=r[e];this._checkWordsRow(o,this.grid.width,t)}for(var s=this.grid.getDirtyCols(),e=0;e<s.length;e++){var o=s[e];this._checkWordsCol(o,this.grid.height,t)}this.grid.removeUsed(),this.grid.clearDirty(),this.grid.dropFloaters(),t++}this.tickInterval=setInterval(function(){i.tick()},this.tickDelay)},_checkWordsRow:function(i,t,r){i:for(var e=0;e<t;e++)if(!this.grid.isSquareEmpty(e,i))for(var s=t-1;s>e;s--)if(!this.grid.isSquareEmpty(s,i)){var o=this.grid.getLetters(e,i,s,i);if(!(""===o||o.length<this.arg("minWordLength"))&&this.wordstore.isValidWord(o)){var a=this.wordstore.getScore(o);this.foundWord(o),this.increaseScore(a*r),this.grid.markSquaresUsed(e,i,s,i);break i}}},_checkWordsCol:function(i,t,r){i:for(var e=0;e<t;e++)if(!this.grid.isSquareEmpty(i,e))for(var s=t-1;s>e;s--)if(!this.grid.isSquareEmpty(i,s)){var o=this.grid.getLetters(i,e,i,s);if(!(""===o||o.length<this.arg("minWordLength"))&&this.wordstore.isValidWord(o)){var a=this.wordstore.getScore(o);this.foundWord(o),this.increaseScore(a*r),this.grid.markSquaresUsed(i,e,i,s);break i}}},increaseScore:function(i){this.score=this.score+i,$("#score").text(this.score)},foundWord:function(i){var t=$("<li>"+i+"</li>");$("#found-words").prepend($(t))},gameOver:function(){clearInterval(this.tickInterval),$("#dialog").dialog()},loadLang:function(i){var t="js/lang/"+i+".js";this.wordstore=new Wordstore(t)}};
